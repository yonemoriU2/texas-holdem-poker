# テスト戦略と実行方法

## 概要

このプロジェクトでは、包括的なテスト戦略を採用して、テキサスホールデムポーカーゲームの品質を保証しています。

## テストの種類

### 1. ユニットテスト
- **目的**: 個別の関数、コンポーネント、ユーティリティの動作を検証
- **実行**: `npm run test:run`
- **場所**: `src/**/__tests__/`

#### テスト対象
- ハンド評価ロジック (`handEvaluator.test.ts`)
- ゲーム状態管理 (`gameReducer.test.ts`)
- AIロジック (`aiLogic.test.ts`, `advancedAI.test.ts`)
- ベッティングユーティリティ (`bettingUtils.test.ts`)
- エラーハンドリング (`errorHandling.test.ts`)
- コンポーネント (`*.test.tsx`)

### 2. 統合テスト
- **目的**: 複数のコンポーネント間の連携を検証
- **実行**: `npm run test:integration`
- **場所**: `src/__tests__/integration.test.tsx`

#### テスト内容
- ゲーム初期化
- ベッティングアクション
- ゲームフェーズ進行
- ゲーム継続機能
- エラーハンドリング
- AI行動の妥当性
- レスポンシブデザイン
- パフォーマンス

### 3. E2Eテスト (Cypress)
- **目的**: 実際のブラウザ環境での完全なユーザー体験を検証
- **実行**: `npm run test:e2e`
- **場所**: `cypress/e2e/`

#### テストファイル
- `integration.cy.ts`: 完全なゲームプレイシナリオ
- `ai-behavior.cy.ts`: AI行動の妥当性テスト
- `user-interaction.cy.ts`: ユーザーインタラクション統合テスト

## テスト実行方法

### 開発環境での実行

```bash
# すべてのテストを実行
npm run test:all

# ユニットテストのみ
npm run test:run

# 統合テストのみ
npm run test:integration

# E2Eテストのみ
npm run test:e2e

# E2Eテストをインタラクティブモードで実行
npm run test:e2e:open
```

### CI/CD環境での実行

GitHub Actionsで自動的に以下のテストが実行されます：

1. **ユニットテスト**: コードの変更時に即座に実行
2. **統合テスト**: コンポーネント間の連携を検証
3. **E2Eテスト**: 実際のブラウザ環境での動作確認
4. **パフォーマンステスト**: Lighthouseを使用した性能測定
5. **セキュリティテスト**: 依存関係の脆弱性チェック

## テストカバレッジ

### 目標カバレッジ
- **ユニットテスト**: 90%以上
- **統合テスト**: 主要機能の100%
- **E2Eテスト**: 重要なユーザーフローの100%

### カバレッジレポート
```bash
# カバレッジレポートを生成
npm run test:run -- --coverage
```

## テストデータ

### モックデータ
- AIの思考時間を短縮するためのモック
- カード配布の決定論的なモック
- ゲーム状態の予測可能なモック

### テストフィクスチャ
- 様々なハンド強度のテストケース
- エッジケースのシナリオ
- パフォーマンステスト用の大量データ

## テストのベストプラクティス

### 1. テストの独立性
- 各テストは独立して実行可能
- テスト間の依存関係を避ける
- 適切なセットアップとクリーンアップ

### 2. テストの可読性
- 説明的なテスト名
- 適切なアサーション
- テストの意図を明確にする

### 3. テストの保守性
- DRY原則の適用
- 共通のテストユーティリティの活用
- 定期的なテストの見直し

### 4. パフォーマンス
- 高速なテスト実行
- 適切なモックの使用
- 並列実行の活用

## デバッグとトラブルシューティング

### テストの失敗時の対処

1. **ログの確認**
   ```bash
   npm run test:run -- --reporter=verbose
   ```

2. **特定のテストの実行**
   ```bash
   npm run test:run -- --grep "テスト名"
   ```

3. **E2Eテストのデバッグ**
   ```bash
   npm run test:e2e:open
   ```

### よくある問題と解決策

#### 1. タイミングの問題
- `waitFor`を使用して非同期処理を待機
- 適切なタイムアウト設定
- 安定したセレクターの使用

#### 2. モックの問題
- モックの適切なリセット
- 依存関係の正しいモック
- テスト間でのモックの分離

#### 3. 環境の問題
- Node.jsバージョンの確認
- 依存関係の更新
- キャッシュのクリア

## 継続的改善

### 定期的なレビュー
- テストカバレッジの監視
- テスト実行時間の最適化
- 新しいテストケースの追加

### フィードバックループ
- 失敗したテストの分析
- テストの品質向上
- 開発チームとの協力

## 参考資料

- [Vitest公式ドキュメント](https://vitest.dev/)
- [Cypress公式ドキュメント](https://docs.cypress.io/)
- [Testing Library公式ドキュメント](https://testing-library.com/)
- [React Testing Best Practices](https://react.dev/learn/testing) 